# Groups and Recap of Covered Concepts

We briefly revisit foundational algebraic structures and number-theoretic results that underlie much of modern cryptography and primality testing.

Let \( G \) be a non-empty set equipped with a binary operation \( \cdot \). The pair \( (G, \cdot) \) is called a **group** if it satisfies the following axioms:

1. **Closure**: For all \( a, b \in G \), the product \( ab \in G \).
2. **Associativity**: For all \( a, b, c \in G \), we have \( (ab)c = a(bc) \).
3. **Identity Element**: There exists an element \( e \in G \) such that \( ae = ea = a \) for all \( a \in G \).
4. **Inverses**: For every \( a \in G \), there exists \( a' \in G \) such that \( aa' = a'a = e \).

If the group operation is also **commutative** (i.e., \( ab = ba \) for all \( a, b \in G \)), then the group is called **abelian**.

## Subgroups and Normal Subgroups

Once we have a group $(G, \cdot)$, a natural question arises: can a smaller set inside $G$ also form a group under the same operation?

A **subgroup** $H \subseteq G$ is a subset of $G$ that forms a group under the same operation. Formally, $H$ is a subgroup of $G$ if:

* $e \in H$ (the identity of $G$ is in $H$),
* $a, b \in H \Rightarrow ab \in H$ (closure),
* $a \in H \Rightarrow a^{-1} \in H$ (inverses exist).

We denote this as $H \leq G$. Every group trivially has at least two subgroups: the **trivial subgroup** $\{e\}$, and the group itself.


A subgroup $N \leq G$ is called **normal**, written $N \trianglelefteq G$, if it is invariant under conjugation by elements of $G$, i.e., for all $g \in G$ and $n \in N$:

$$
gng^{-1} \in N
$$

Normal subgroups are central to constructing **quotient groups** $G / N$, which are key in understanding the internal structure of a group. In cryptography, the concept of normality appears in group homomorphisms, cosets, and the study of group actions, especially in elliptic curve groups and protocol design.

We will revisit these concepts in greater depth when we examine group isomorphisms, cosets, and applications to algebraic number theory and cryptographic constructions.

## Additive Group \( \mathbb{Z}_n \)

The set \( \mathbb{Z}_n = \{0, 1, 2, \ldots, n - 1\} \), together with addition modulo \( n \), forms an abelian group \( (\mathbb{Z}_n, +) \). This group satisfies:

- **Closure**: \( a + b \bmod n \in \mathbb{Z}_n \),
- **Associativity**: \( (a + b) + c \equiv a + (b + c) \mod n \),
- **Identity**: \( 0 \) is the additive identity,
- **Inverses**: For every \( a \in \mathbb{Z}_n \), there exists \( b \in \mathbb{Z}_n \) such that \( a + b \equiv 0 \mod n \).


## Multiplicative Group \( \mathbb{Z}_n^* \)

The **multiplicative group modulo \( \mathbb{Z}_n^* \)** is defined as:

\[
\mathbb{Z}_n^* = \{ a \in \mathbb{Z}_n \mid \gcd(a, n) = 1 \}
\]

- This set forms a group under multiplication modulo \( n \).
- If \( n \) is prime, then \( \mathbb{Z}_n^* = \{1, 2, \ldots, n-1\} \).

**Order**: The number of elements in \( \mathbb{Z}_n^* \) is given by Euler’s totient function:

\[
|\mathbb{Z}_n^*| = \varphi(n)
\]


## Euler’s Theorem

Let \( n \geq 2 \). If \( a \in \mathbb{Z}_n^* \), then:

\[
a^{\varphi(n)} \equiv 1 \mod n
\]

Additionally, if \( r \equiv s \mod \varphi(n) \), then:

\[
a^r \equiv a^s \mod n \quad \text{for all } a \in \mathbb{Z}
\]

**Interpretation**: Exponents modulo \( \varphi(n) \) are sufficient when working modulo \( n \) in the multiplicative group \( \mathbb{Z}_n^* \).


## Fermat’s Little Theorem

Let \( p \) be a prime number. Then for any integer \( a \) such that \( \gcd(a, p) = 1 \):

\[
a^{p-1} \equiv 1 \mod p
\]

Moreover, if \( r \equiv s \mod (p - 1) \), then:

\[
a^r \equiv a^s \mod p \quad \text{for all } a \in \mathbb{Z}
\]

A useful special case:

\[
a^p \equiv a \mod p \quad \text{for all } a \in \mathbb{Z}
\]


```python
from Crypto.Util.number import getPrime
from math import gcd

p = getPrime(512)
a = 1234

# Fermat's Little Theorem: a^(p-1) ≡ 1 mod p
print(pow(a, p-1, p))

# Check exponent reduction modulo (p-1)
r = pow(2, 16) + 1
s = 20 * (p - 1) + r
print(s % (p - 1) == r % (p - 1))
print(pow(a, s, p) == pow(a, r, p))
```

## Cyclic Groups

A **cyclic group** is a group in which all elements can be generated by repeated application of the group operation to a single element, called a **generator** \( g \). Formally, a group \( G \) is cyclic if:

\[
G = \{ g^0, g^1, \dots, g^{m-1} \}
\]

where \( m = |G| \) is the **order** of the group.

### Generators and the Order of Elements

Let \( a \in \mathbb{Z}_n^* \). The **order** of \( a \), denoted \( \operatorname{ord}(a) \), is the smallest positive integer \( t \) such that:

\[
a^t \equiv 1 \mod n
\]

If \( \operatorname{ord}(a) = \varphi(n) \), then \( a \) is a **generator** of the group \( \mathbb{Z}_n^* \).


### Properties of Generators

- The group \( \mathbb{Z}_n^* \) is cyclic **if and only if** \( n \in \{2, 4, p^k, 2p^k\} \), where \( p \) is an odd prime and \( k \geq 1 \).
- If \( p \) is a prime, then \( \mathbb{Z}_p^* \) is always cyclic.
- If \( g \) is a generator of \( \mathbb{Z}_n^* \), then:

\[
\mathbb{Z}_n^* = \{ g^i \bmod n \mid 0 \leq i \leq \varphi(n) - 1 \}
\]

- Let \( g \) be a generator of \( \mathbb{Z}_n^* \). Then \( b = g^i \bmod n \) is also a generator **if and only if** \( \gcd(i, \varphi(n)) = 1 \). Hence, if \( \mathbb{Z}_n^* \) is cyclic, it has exactly \( \varphi(\varphi(n)) \) generators.
- A necessary and sufficient condition for \( g \in \mathbb{Z}_n^* \) to be a generator of \( \mathbb{Z}_n^* \) is:

\[
g^{\varphi(n)/p} \not\equiv 1 \mod n \quad \text{for every prime divisor } p \mid \varphi(n)
\]


But how do we actually find generators? We provide a Sagemath implementation in `src/generators.sage`. This code explores whether a given number is a *generator* of the multiplicative group $\mathbb{Z}_p^*$, which consists of all integers from 1 to $p - 1$ that are invertible modulo a prime $p$. In the first part, the function `checkgen(g, p)` determines whether a number $g$ is a generator modulo $p$ by checking whether any of the values $g^{(p-1)/q} \mod p$ equal 1, where $q$ runs over the prime factors of $p - 1$. If any of these values equals 1, then $g$ cannot generate all elements of $\mathbb{Z}_p^*$, and the function returns `False`.

The second part of the code examines the behavior of elements in the multiplicative group $\mathbb{Z}_p^*$ for a small prime $p = 17$, providing a concrete illustration of what it means for an element to be a *generator* of a cyclic group. It constructs the group $\mathbb{Z}_p^*$, implemented via SageMath's `GF(p)` (the finite field $\mathbb{F}_p$), and computes successive powers of each element to reveal their cyclic structure. Using the `primitive_root` function, it identifies a generator $g$, and then displays the full sequence $g^1, g^2, \dots, g^{p-1} \mod p$, showing how a generator can reproduce every nonzero element of $\mathbb{Z}_p$.

Although the code uses finite fields—which we haven't yet explored formally—it's helpful to imagine them as algebraic structures with two operations (addition and multiplication), where the multiplicative part forms a group. In this setting, *primitive roots* correspond to *generators* of that group. While this may seem abstract for now, the connection between primitive roots, generators, and the structure of finite fields will become clearer as we build further algebraic foundations in the next sections.

---



## Roots in $\mathbb{Z}_p$
Continuing from our exploration of cyclic groups and generators, we now turn to the concept of **roots in modular arithmetic**, particularly in $\mathbb{Z}_p$, where $p$ is a prime. Understanding roots—especially square roots—is essential not only in number theory but also in cryptographic applications (e.g., quadratic residuosity, discrete logarithms).

Let $p$ be a prime and $a \in \mathbb{Z}_p$. If $\gcd(e, p - 1) = 1$, then there exists a modular inverse $d \equiv e^{-1} \mod (p - 1)$, and we can write:

$$
a^{e^{-1}} \equiv a^d \mod p
$$

**Justification**:
If $de \equiv 1 \mod (p - 1)$, then for some $k \in \mathbb{Z}$ we have $de = k(p - 1) + 1$. Hence:

$$
a^{de} \equiv a^{k(p-1)+1} \equiv (a^{p - 1})^k \cdot a \equiv 1 \cdot a \equiv a \mod p
$$

This shows that under the right conditions, modular exponentiation can be used to compute roots in $\mathbb{Z}_p$.

### Computing Square Roots in $\mathbb{Z}_p$

When it comes to finding square roots modulo a prime $p$, the method depends crucially on the value of $p \mod 4$.

### Case 1: $p \equiv 3 \mod 4$

In this favorable case, we can compute square roots using a very efficient formula:

$$
\sqrt{a} \equiv a^{\frac{p + 1}{4}} \mod p
$$

**Why this works**:
Since $p + 1 \equiv 0 \mod 4$, we get:

$$
\left(a^{\frac{p + 1}{4}}\right)^2 = a^{\frac{p + 1}{2}} = a^{\frac{p - 1}{2}} \cdot a \equiv 1 \cdot a = a \mod p
$$

This identity allows us to recover a square root with a single modular exponentiation.

### Case 2: $p \equiv 1 \mod 4$

Here, the situation is more complex. The square root cannot be computed directly with a short formula as above. Instead, we must use a more general procedure called the **Tonelli–Shanks algorithm**. This algorithm systematically finds square roots in $\mathbb{Z}_p$ and works for any odd prime $p$, but it is a bit more involved and computationally heavier.

We only mention the Tonelli–Shanks method briefly for now; it will be explored more deeply in a future part of this series once we’ve built up more algebraic tools. For those interested in a preview, you can consult its [Wikipedia article](https://en.wikipedia.org/wiki/Tonelli%E2%80%93Shanks_algorithm).

In summary, the ability to extract roots in $\mathbb{Z}_p$ depends on both the exponent structure of the group and the congruence class of the modulus. These insights form the basis for more advanced number-theoretic and cryptographic techniques that we will continue to explore.


---



## Quadratic Residues
Continuing our journey into modular arithmetic, we now turn to a deeper concept that plays a crucial role in number theory and cryptography: **quadratic residues**. This notion is directly connected to the problem of extracting square roots in $\mathbb{Z}_p$ and helps explain why some numbers have square roots modulo $p$, while others do not.

Let $a \in \mathbb{Z}_n^*$, i.e., $a$ is invertible modulo $n$. Then:

* We say that $a$ is a **quadratic residue modulo $n$** if there exists an integer $x \in \mathbb{Z}_n$ such that:

  $$
  x^2 \equiv a \mod n
  $$
* If no such $x$ exists, $a$ is called a **quadratic non-residue modulo $n$**.
* The value $x$ in this case is called a **square root** of $a \mod n$.

Let us define:

* $Q_n$: the set of all quadratic residues modulo $n$
* $\overline{Q}_n$: the set of quadratic non-residues modulo $n$

Note that $0 \notin \mathbb{Z}_n^*$, and hence $0 \notin Q_n$ and $0 \notin \overline{Q}_n$.

### Size of Residue Sets

Let $p$ be an odd prime. Then:

* The multiplicative group $\mathbb{Z}_p^*$ has $p - 1$ elements.
* Exactly half of them are quadratic residues:

  $$
  |Q_p| = \frac{p - 1}{2}, \quad |\overline{Q}_p| = \frac{p - 1}{2}
  $$

If $n = pq$ is a product of two distinct odd primes, then:

* The total number of invertible elements is $\phi(n) = (p - 1)(q - 1)$
* The number of quadratic residues is:

  $$
  |Q_n| = \frac{(p - 1)(q - 1)}{4}, \quad |\overline{Q}_n| = \frac{3(p - 1)(q - 1)}{4}
  $$

This reflects the fact that as the modulus becomes more composite, distinguishing residues from non-residues becomes more complex—a challenge exploited in cryptographic constructions such as the Goldwasser–Micali cryptosystem.

### Number of Roots

* If $p$ is prime and $a \in Q_p$, then $a$ has **exactly two** square roots modulo $p$.
* More generally, if $n = p_1^{e_1} p_2^{e_2} \cdots p_k^{e_k}$ is a product of distinct odd prime powers, then every quadratic residue $a \in Q_n$ has exactly $2^k$ distinct square roots modulo $n$.

This exponential growth in the number of roots with respect to the number of prime factors underpins the difficulty of the **quadratic residuosity problem**, a foundational assumption in several cryptographic protocols.

### Multiplicative Behavior

Let $p$ be an odd prime. Then the following properties hold for the multiplication of residues and non-residues modulo $p$:

* QR × QR = QR
* QR × NR = NR
* NR × NR = QR

These identities confirm that $Q_p$ forms a *subgroup* of $\mathbb{Z}_p^*$ of index 2. This algebraic structure is central to defining the *Legendre symbol* and generalizing to the *Jacobi symbol* over composite moduli, tools we will explore soon.

Here is a clean and well-structured markdown version of your section, with improved flow, terminology consistency, and academic tone:

---

## Legendre and Jacobi Symbols

### Legendre Symbol

Let $p$ be an odd prime and $a \in \mathbb{Z}$. The **Legendre symbol** $\left( \frac{a}{p} \right)$ is a number-theoretic function that indicates whether $a$ is a **quadratic residue modulo** $p$:

$$
\left(\dfrac{a}{p}\right)=
\begin{cases}
1 & \text{if } a \not\equiv 0 \mod p \text{ and } \exists x: x^2 \equiv a \mod p \\
-1 & \text{if } a \not\equiv 0 \mod p \text{ and no such } x \text{ exists} \\
0 & \text{if } a \equiv 0 \mod p
\end{cases}
$$

#### Key Properties of the Legendre Symbol

* **Euler's Criterion**:
  For $a \not\equiv 0 \mod p$,

  $$
  a^{\frac{p - 1}{2}} \equiv \left( \frac{a}{p} \right) \mod p
  $$

* **Congruence Invariance**:
  If $a \equiv b \mod p$, then $\left( \frac{a}{p} \right) = \left( \frac{b}{p} \right)$

* **Multiplicativity**:

  $$
  \left( \frac{ab}{p} \right) = \left( \frac{a}{p} \right) \left( \frac{b}{p} \right)
  $$

* **Special Values**:

  $$
  \left( \frac{-1}{p} \right) = (-1)^{\frac{p - 1}{2}} \quad \Rightarrow \quad
  \left( \frac{-1}{p} \right) = 1 \iff p \equiv 1 \mod 4
  $$

  $$
  \left( \frac{2}{p} \right) = (-1)^{\frac{p^2 - 1}{8}} \quad \Rightarrow \quad
  \left( \frac{2}{p} \right) = 1 \iff p \equiv \pm 1 \mod 8
  $$

* **Quadratic Reciprocity Law** (for distinct odd primes $p$, $q$):

  $$
  \left( \frac{p}{q} \right) \left( \frac{q}{p} \right) = (-1)^{\frac{p - 1}{2} \cdot \frac{q - 1}{2}}
  $$


### Jacobi Symbol

The **Jacobi symbol** $\left( \frac{a}{n} \right)$ is a generalization of the Legendre symbol to any odd positive integer $n$. Suppose $n = p_1^{e_1} p_2^{e_2} \cdots p_k^{e_k}$ is the prime factorization of $n$. Then:

$$
\left( \frac{a}{n} \right) = \prod_{i=1}^k \left( \frac{a}{p_i} \right)^{e_i}
$$

> **Important:** The Jacobi symbol **does not** always determine whether $a$ is a quadratic residue modulo $n$.
> It may return 1 even when $a$ is **not** a square mod $n$.

#### Key Properties of the Jacobi Symbol

Let $a, b \in \mathbb{Z}$, and let $m, n$ be odd positive integers:

* **Congruence Invariance**:

  $$
  a \equiv b \mod n \quad \Rightarrow \quad \left( \frac{a}{n} \right) = \left( \frac{b}{n} \right)
  $$

* **Multiplicativity in Numerator and Denominator**:

  $$
  \left( \frac{ab}{n} \right) = \left( \frac{a}{n} \right) \left( \frac{b}{n} \right), \qquad
  \left( \frac{a}{mn} \right) = \left( \frac{a}{m} \right) \left( \frac{a}{n} \right)
  $$

* **Special Values**:

  $$
  \left( \frac{-1}{n} \right) = (-1)^{\frac{n - 1}{2}}, \qquad
  \left( \frac{2}{n} \right) = (-1)^{\frac{n^2 - 1}{8}}
  $$

* **Quadratic Reciprocity (Extended)**:

  $$
  \left( \frac{m}{n} \right) \left( \frac{n}{m} \right) = (-1)^{\frac{m - 1}{2} \cdot \frac{n - 1}{2}}
  \quad \text{for } \gcd(m, n) = 1
  $$

We have a custom python implementation into `src/jacobisymbol.py`. 

Here is a refined and well-formatted academic markdown version of your Carmichael number section, with improved clarity, flow, and consistency:

---

## Carmichael Numbers


A *Carmichael number* is a composite integer $n$ such that:

$$
a^{n - 1} \equiv 1 \pmod{n} \quad \text{for all } a \in \mathbb{Z} \text{ with } \gcd(a, n) = 1
$$

In other words, Carmichael numbers satisfy FLTfor all bases coprime to $n$, despite being *composite*. This makes them *pseudoprimes to all bases*, and thus dangerous counterexamples in primality testing.

### Korselt’s Criterion (Necessary and Sufficient Condition)

A composite number $n$ is a Carmichael number **if and only if**:

1. $n$ is **square-free** (i.e., not divisible by any square $p^2$),
2. For every prime $p \mid n$, we have:

$$
p - 1 \mid n - 1
$$

This characterization allows efficient construction and verification of Carmichael numbers.

> Every Carmichael number must be the product of *at least three distinct primes*.

### The Carmichael Function $\lambda(n)$


The *Carmichael function* $\lambda(n)$ is defined as the smallest positive integer $k$ such that:

$$
a^k \equiv 1 \pmod{n} \quad \text{for all } a \in \mathbb{Z}_n^* = \{ a \in \mathbb{Z} \mid \gcd(a, n) = 1 \}
$$

That is, $\lambda(n)$ is the **exponent** of the multiplicative group $\mathbb{Z}_n^*$.


### Computation of $\lambda(n)$

Let $n = p_1^{\alpha_1} p_2^{\alpha_2} \cdots p_k^{\alpha_k}$ be the prime factorization of $n$. Then:

$$
\lambda(n) = \operatorname{lcm}\big( \lambda(p_1^{\alpha_1}), \ldots, \lambda(p_k^{\alpha_k}) \big)
$$

For individual prime powers:

$$
\lambda(p^\alpha) =
\begin{cases}
\phi(p^\alpha) & \text{if } p \geq 3 \text{ or } \alpha \leq 2 \\
\frac{1}{2} \phi(2^\alpha) & \text{if } p = 2 \text{ and } \alpha \geq 3
\end{cases}
$$

It has the following properties: 

* If $a \mid b$, then $\lambda(a) \mid \lambda(b)$
* $\lambda(\operatorname{lcm}(a, b)) = \operatorname{lcm}(\lambda(a), \lambda(b))$

The Carmichael function plays a central role in cryptographic protocols and pseudoprime constructions, especially in generating numbers that *appear* prime under exponentiation tests but are, in fact, composite. It is closely connected to the group structure of $\mathbb{Z}_n^*$ and provides a more refined exponent than Euler’s $\phi(n)$ in this context.


## Wrap-Up

We laid the foundational groundwork of *group theory* and *modular arithmetic*, key pillars in modern number theory and cryptography. We introduced the definition of a group and explored the structure of additive and multiplicative groups modulo $n$, particularly the rich behavior of $\mathbb{Z}_n^*$. Special attention was given to *cyclic groups*, *generators*, and *orders of elements*, which underlie important concepts such as *discrete logarithms*.

We also discussed more advanced notions such as *subgroups*, *normal subgroups*, and the *Carmichael function*, preparing us for future explorations into deeper group-theoretic constructs. 

This material serves as a primer—a high-level overview meant to “set the field.” In the upcoming parts of this series, we will build on these algebraic foundations to investigate more sophisticated topics, including *finite fields*, *quotient groups*, and *elliptic curve groups*, as well as *probabilistic* and *deterministic* primality tests like *AKS*, *APR-CL*, and *elliptic curve-based methods*.

We have so far stated key results and properties with minimal proofs. As we move forward, we will return to these concepts with deeper theoretical tools and proofs, grounding our understanding both algebraically and computationally.

Stay tuned and keep exploring!
